{% extends "user/userbase.html" %}
{% block content %}

<div class="container mt-5 text-white" style="padding-top: 50px;">

  <style>
    .edit-star {
      font-size: 30px;
      cursor: pointer;
      color: gray;
    }

    .edit-star.gold {
      color: gold;
    }

    textarea {
      width: 100%;
      resize: vertical;
    }
  </style>

  <form action="{{ url_for('update_review', marker_id=marker.id) }}" method="post" onsubmit="syncStars()">
    <label>Rate this location:</label><br>
    <div id="edit-stars" data-selected="{{ review.stars }}">
      {% for i in range(1, 6) %}
        <span class="edit-star" data-value="{{ i }}">&#9733;</span>
      {% endfor %}
    </div>
    <input type="hidden" name="stars" id="selected-stars" value="{{ review.stars }}"><br><br>

    <label>Comment:</label><br>
    <textarea name="commentary" rows="4">{{ review.commentary }}</textarea><br><br>

    <button type="submit" name="action" value="save" class="btn btn-success">Save</button>
    <a href="{{ url_for('maptest') }}" class="btn btn-secondary">Discard</a>
    <button type="submit" name="action" value="delete" class="btn btn-danger"
            onclick="{% if is_only_review %}return confirm('Deleting the only review will delete the marker. Are you sure?'){% else %}return confirm('Are you sure you want to delete this review?'){% endif %};">
      Delete Review
    </button>
  </form>
</div>
{% endblock %}
{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const starContainer = document.getElementById("edit-stars");
    const selected = parseInt(starContainer.getAttribute("data-selected"));
    highlightStars(selected);

    starContainer.addEventListener("click", function (e) {
      if (e.target.classList.contains("edit-star")) {
        const value = parseInt(e.target.dataset.value);
        starContainer.setAttribute("data-selected", value);
        document.getElementById("selected-stars").value = value;
        highlightStars(value);
      }
    });

    function highlightStars(value) {
      starContainer.querySelectorAll(".edit-star").forEach(star => {
        star.classList.toggle("gold", parseInt(star.dataset.value) <= value);
      });
    }
  });

  function syncStars() {
    const starContainer = document.getElementById("edit-stars");
    const value = parseInt(starContainer.getAttribute("data-selected"));
    document.getElementById("selected-stars").value = value;
  }
</script>

{% endblock %}
